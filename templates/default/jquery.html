<link href="img/jqueryui/themes/base/jquery-ui.min.css" rel="stylesheet" type="text/css">
<link href="img/jquery-datetimepicker/build/jquery.datetimepicker.min.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="img/jquery/jquery.min.js"></script>
<script type="text/javascript" src="img/jqueryui/jquery-ui.min.js"></script>
<script type="text/javascript" src="img/jqueryui/ui/minified/i18n/datepicker-{$language}.js"></script>
<script type="text/javascript" src="img/jquery-datetimepicker/build/jquery.datetimepicker.full.min.js"></script>
<script type="text/javascript">
<!--
	$(function() {
		var autocomplete = "off";

		$('.calendar').datepicker({
			dateFormat: "yy/mm/dd",
			changeYear: true
		})
		.attr("autocomplete", autocomplete);

		$('.calendar-time').datetimepicker({
			lang: "{$language}",
			step: 30,
			closeOnDateSelect: true
		})
		.attr("autocomplete", autocomplete);

		$('[title]').each(function() {
			tooltipClass = "";
			if ($(this).hasClass("alert")) {
				tooltipClass += " alert";
				if ($(this).hasClass("bold"))
					tooltipClass += " bold";
			} else if ($(this).hasClass("bold"))
				tooltipClass += "bold";
			$(this).tooltip({
				show: { delay: 500 },
				track: true,
				tooltipClass: tooltipClass
			});
		});

		[
			{ class: 'voipaccountinfo', url: '?m=voipaccountinfoshort&id='},
			{ class: 'invoiceinfo', url: '?m=invoiceinfo&id='},
			{ class: 'docnumber', url: '?m=number&id='},
			{ class: 'customerinfo', url: '?m=customerinfoshort&id='},
			{ class: 'nodelist', url: '?m=nodelistshort&id='},
			{ class: 'ewxnodelist', url: '?m=ewxnodelist&id='},
			{ class: 'rtticketinfo', url: '?m=rtticketinfo&id='},
			{ class: 'customerassignmentinfo', url: '?m=customerassignmentinfo&id='},
			{ class: 'nodegroupinfo', url: '?m=nodeinfo&nodegroups=1&id='},
			{ class: 'netdevlist', url: '?m=ewxdevlist&id='}
		].forEach(function(popup) {
			$('.' + popup.class).tooltip({
				items: '.' + popup.class,
				track: true,
				tooltipClass: popup.class,
				content: function(callback) {
					var elem = $(this);
					var resourceid = elem.attr('data-resourceid');
					$.ajax(popup.url + resourceid, {
						async: true,
						success: function(data) {
							callback(data);
						}
					});
				}
			});
		});

		var documentviews = $('.documentview');

		documentviews.tooltip({
			track: true,
			items: '.documentview-image',
			tooltipClass: 'documentview',
			content: function() {
				var href = $(this).attr('href');
				return '<img src="' + href + '" style="max-width: 300px;">';
				//return '';
			}
		});

		documentviews.on("click", function() {
			var dialog = $('#' + $(this).attr('data-dialog-id'));
			var url = dialog.attr('data-url');
			if ($(this).hasClass('documentview-image')) {
				$(this).tooltip('disable');
				dialog.html('<img src="' + url + '" style="width: 100%;">');
			} else if ($(this).hasClass('documentview-audio')) {
				dialog.html('<audio src="' + url + '" style="width: 100%;" controls preload="none">'
					+ "{trans("Your browser does not support the audio element.")}"
					+ '</audio>');
				var audioelem = dialog.find('audio').get(0);
				audioelem.currentTime = 0;
				audioelem.play();
			} else if ($(this).hasClass('documentview-video')) {
				dialog.html('<video src="' + url + '" style="width: 100%;" controls preload="none">'
					+ "{trans("Your browser does not support the video element.")}"
					+ '</video>');
				var videoelem = dialog.find('video').get(0);
				videoelem.currentTime = 0;
				videoelem.play();
			}
			dialog.dialog('open');
			return false;
		});

		$('.documentviewdialog').dialog({
			modal: true,
			autoOpen: false,
			resizable: false,
			draggable: false,
			minWidth: 0,
			minHeight: 0,
			dialogClass: 'documentviewdialog',
			open: function(event, ui) {
				var elem = $('#' + $(this).attr('id').replace(/dialog/, ''));
				console.log(elem);
				$(this).dialog('option', 'position', elem.hasClass('documentview-audio')
					? { my: 'center', at: 'center', of: window } : { my: 'top', at: 'top', of: window })
					.dialog('option', 'width', '70%');
				$('.ui-widget-overlay').bind('click', function() {
					$(this).siblings('.ui-dialog').find('.ui-dialog-content')
						.dialog('close');
				});
			},
			close: function(event, ui) {
				var elem = $('#' + $(this).attr('id').replace(/dialog/, ''));
				if (elem.hasClass('documentview-image'))
					elem.tooltip('enable');
				else if (elem.hasClass('documentview-audio'))
					$(this).find('audio').get(0).pause();
				else if (elem.hasClass('documentview-video'))
					$(this).find('video').get(0).pause();
			}
		})
//		.on('click', function() {
//			$(this).dialog('close');
//		})
		.parent().resizable({
			aspectRatio: true
		})
		.draggable();

		$(document).on('keyup keydown', function(e) {
			$('body').css('user-select', e.shiftKey ? 'none' : 'auto');
		});

		var tbodies = $('tbody.multi-check');
		$.each(tbodies, function(index, tbody) {
			var tbody = $(tbody);
			var allcheckboxes = tbody.find(':checkbox');
			$.each(allcheckboxes, function(index, checkbox) {
				if (checkbox.length > 1)
					return;
				var checkbox = $(checkbox)[0];
				var row = $(checkbox.closest('tr'));
				row.click(function(e) {
					if (e.shiftKey) {
						//document.getSelection().removeAllRanges();
						var checkboxes = $(this).prevAll('tr').find(':checkbox');
						for (var i = checkboxes.length; i > 0; i--)
							if ($(checkboxes[i - 1]).attr('data-prev-checked') !== undefined)
								break;
						if (i) {
							var checked = $(checkboxes[i - 1]).attr('data-prev-checked') == 'true' ? true : false;
							for (var j = checkboxes.length; j > i; j--)
								checkboxes[j - 1].checked = checked;
							checkbox.checked = checked;
						} else {
							var checkboxes = $(this).nextAll('tr').find(':checkbox');
							for (var i = 1; i <= checkboxes.length; i++)
								if ($(checkboxes[i - 1]).attr('data-prev-checked') !== undefined)
									break;
							if (i <= checkboxes.length) {
								var checked = $(checkboxes[i - 1]).attr('data-prev-checked') == 'true' ? true : false;
								for (var j = 1; j <= i; j++)
									checkboxes[j - 1].checked = checked;
								checkbox.checked = checked;
							}
						}
					} else {
						checkbox.checked = !checkbox.checked;
						$.each(allcheckboxes, function(index, checkbox) {
							$($(checkbox)[0]).removeAttr('data-prev-checked');
						});
						$(checkbox).attr('data-prev-checked', checkbox.checked);
					}
				});
				row.find(':checkbox').click(function(e) {
					if (e.shiftKey) {
						//document.getSelection().removeAllRanges();
						var checkboxes = $(this).closest('tr').prevAll('tr').find(':checkbox');
						for (var i = checkboxes.length; i > 0; i--)
							if ($(checkboxes[i - 1]).attr('data-prev-checked') !== undefined)
								break;
						if (i) {
							var checked = $(checkboxes[i - 1]).attr('data-prev-checked') == 'true' ? true : false;
							for (var j = checkboxes.length; j > i; j--)
								checkboxes[j - 1].checked = checked;
							this.checked = checked;
						} else {
							var checkboxes = $(this).closest('tr').nextAll('tr').find(':checkbox');
							for (var i = 1; i <= checkboxes.length; i++)
								if ($(checkboxes[i - 1]).attr('data-prev-checked') !== undefined)
									break;
							if (i <= checkboxes.length) {
								var checked = $(checkboxes[i - 1]).attr('data-prev-checked') == 'true' ? true : false;
								for (var j = 1; j <= i; j++)
									checkboxes[j - 1].checked = checked;
								this.checked = checked;
							}
						}
					} else {
						$.each(allcheckboxes, function(index, checkbox) {
							$($(checkbox)[0]).removeAttr('data-prev-checked');
						});
						$(this).attr('data-prev-checked', this.checked);
					}
					e.stopPropagation();
				});
				row.find('a').click(function(e) {
					e.stopPropagation();
				});
			});
		});
	});
//-->
</script>
