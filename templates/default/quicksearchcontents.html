{block name="quicksearchcontents"}

<div id="qs-customer" class="lms-ui-quick-search-field" data-mode="customer" data-label="{trans("<!qs>customer")}">
    <img src="img/customer.gif" alt="" {tip text="Enter customer ID, first/lastname, email or address and press Enter"}>
    <select id="qs-customer-properties" class="lms-ui-quicksearch-property-selection lms-ui-multiselect-selection-group" multiple>
        <option value="id"{if !isset($qs_properties.customer) || isset($qs_properties.customer.id)} selected{/if}>{trans("<!qs>customer id")}</option>
        <option value="name"{if !isset($qs_properties.customer) || isset($qs_properties.customer.name)} selected{/if}>{trans("<!qs>customer name")}</option>
        <option value="address"{if !isset($qs_properties.customer) || isset($qs_properties.customer.address)} selected{/if}>{trans("<!qs>address")}</option>
        <option value="post_name"{if !isset($qs_properties.customer) || isset($qs_properties.customer.post_name)} selected{/if}>{trans("<!qs>post name")}</option>
        <option value="post_address"{if !isset($qs_properties.customer) || isset($qs_properties.customer.post_address)} selected{/if}>{trans("<!qs>post address")}</option>
        <option value="location_address"{if !isset($qs_properties.customer) || isset($qs_properties.customer.location_address)} selected{/if}>{trans("<!qs>location address")}</option>
        <option value="email"{if !isset($qs_properties.customer) || isset($qs_properties.customer.email)} selected{/if}>{trans("<!qs>email")}</option>
    </select>
    <input type="text" name="qs[customer]" value="" size="15" {tip text="Enter customer ID, first/lastname, email or address and press Enter" class="blend lms-ui-quick-search-input"}>
</div>

<div id="qs-phone" class="lms-ui-quick-search-field" data-mode="phone" data-label="{trans("<!qs>phone")}">
    <img src="img/phone.gif" alt="" {tip text="Enter phone number and press Enter"}>
    <input type="text" name="qs[phone]" value="" size="15" {tip text="Enter phone number and press Enter" class="blend lms-ui-quick-search-input"}>
</div>

<div id="qs-node" class="lms-ui-quick-search-field" data-mode="node" data-label="{trans("<!qs>node")}">
    <img src="img/node.gif" alt="" {tip text="Enter node ID, name, IP address or MAC address and press Enter"}>
    <select id="qs-node-properties" class="lms-ui-quicksearch-property-selection lms-ui-multiselect-selection-group" multiple>
        <option value="id"{if !isset($qs_properties.node) || isset($qs_properties.node.id)} selected{/if}>{trans("<!qs>node id")}</option>
        <option value="name"{if !isset($qs_properties.node) || isset($qs_properties.node.name)} selected{/if}>{trans("<!qs>node name")}</option>
        <option value="ip"{if !isset($qs_properties.node) || isset($qs_properties.node.ip)} selected{/if}>{trans("<!qs>ip address")}</option>
        <option value="public_ip"{if !isset($qs_properties.node) || isset($qs_properties.node.public_ip)} selected{/if}>{trans("<!qs>public ip address")}</option>
        <option value="mac"{if !isset($qs_properties.node) || isset($qs_properties.node.mac)} selected{/if}>{trans("<!qs>mac address")}</option>
    </select>
    <input type="text" name="qs[node]" value="" size="15" {tip text="Enter node ID, name, IP address or MAC address and press Enter" class="blend lms-ui-quick-search-input"}>
</div>

<div id="qs-network" class="lms-ui-quick-search-field" data-mode="network" data-label="{trans("<!qs>network")}">
    <img src="img/network.gif" alt="" {tip text="Enter network ID, name or IP address and press Enter"}>
    <input type="text" name="qs[network]" value="" size="15" {tip text="Enter network ID, name or IP address and press Enter" class="blend lms-ui-quick-search-input"}>
</div>

<div id="qs-netnode" class="lms-ui-quick-search-field" data-mode="netnode" data-label="{trans("<!qs>network node")}">
    <img src="img/netnode.png" alt="" {tip text="Enter netnode ID or name and press Enter"}>
    <input type="text" name="qs[netnode]" value="" size="15" {tip text="Enter netnode ID or name and press Enter" class="blend lms-ui-quick-search-input"}>
</div>

<div id="qs-netdev" class="lms-ui-quick-search-field" data-mode="netdevice" data-label="{trans("<!qs>network device")}">
    <img src="img/netdev.gif" alt="" {tip text="Enter device ID, name or serial number and press Enter"}>
    <select id="qs-netdev-properties" class="lms-ui-quicksearch-property-selection lms-ui-multiselect-selection-group" multiple>
        <option value="id"{if !isset($qs_properties.netdevice) || isset($qs_properties.netdevice.id)} selected{/if}>{trans("<!qs>device id")}</option>
        <option value="name"{if !isset($qs_properties.netdevice) || isset($qs_properties.netdevice.name)} selected{/if}>{trans("<!qs>device name")}</option>
        <option value="serial"{if !isset($qs_properties.netdevice) || isset($qs_properties.netdevice.serial)} selected{/if}>{trans("<!qs>device serial number")}</option>
    </select>
    <input type="text" name="qs[netdevice]" value="" size="15" {tip text="Enter device ID, name or serial number and press Enter" class="blend lms-ui-quick-search-input"}>
</div>

<div id="qs-wireless" class="lms-ui-quick-search-field" data-mode="wireless" data-label="{trans("<!qs>wireless")}">
    <img src="img/wireless.gif" alt="" {tip text="Enter wireless SSID and press Enter"}>
    <input type="text" name="qs[wireless]" value="" size="15" {tip text="Enter wireless SSID and press Enter" class="blend lms-ui-quick-search-input"}>
</div>

<div id="qs-ticket" class="lms-ui-quick-search-field" data-mode="ticket" data-label="{trans("<!qs>ticket")}">
    <img src="img/ticket.gif" alt="" {tip text="Enter request tracker ID, subject or requestor name and press Enter"}>
    <select id="qs-ticket-properties" class="lms-ui-quicksearch-property-selection lms-ui-multiselect-selection-group" multiple>
        <option value="id"{if !isset($qs_properties.ticket) || isset($qs_properties.ticket.id)} selected{/if}>{trans("<!qs>ticket id")}</option>
        <option value="subject"{if !isset($qs_properties.ticket) || isset($qs_properties.ticket.subject)} selected{/if}>{trans("<!qs>ticket subject")}</option>
        <option value="requestor"{if !isset($qs_properties.ticket) || isset($qs_properties.ticket.requestor)} selected{/if}>{trans("<!qs>ticket requestor")}</option>
        <option value="customername"{if !isset($qs_properties.ticket) || isset($qs_properties.ticket.customername)} selected{/if}>{trans("<!qs>customer name")}</option>
    </select>
    <input type="text" name="qs[ticket]" value="" size="15" {tip text="Enter request tracker ID, subject or requestor name and press Enter" class="blend lms-ui-quick-search-input"}>
</div>

<div id="qs-account" class="lms-ui-quick-search-field" data-mode="account" data-label="{trans("<!qs>account")}">
    <img src="img/account.gif" alt="" {tip text="Enter account or alias name and press Enter"}>
    <input type="text" name="qs[account]" value="" size="15" {tip text="Enter account or alias name and press Enter" class="blend lms-ui-quick-search-input"}>
</div>

<div id="qs-docum" class="lms-ui-quick-search-field" data-mode="document" data-label="{trans("<!qs>document")}">
    <img src="img/docum.gif" alt="" {tip text="Enter document number and press Enter"}>
    <input type="text" name="qs[document]" value="" size="15" {tip text="Enter document number and press Enter" class="blend lms-ui-quick-search-input"}>
</div>

<div id="qs-customerext" class="lms-ui-quick-search-field" data-mode="customerext" data-label="{trans("<!qs>customer external id")}">
    <img src="img/customers.gif" alt="" {tip text="Enter external customer ID fragment and press Enter"}>
    <input type="text" name="qs[customerext]" value="" size="15" {tip text="Enter external customer ID fragment and press Enter" class="blend lms-ui-quick-search-input"}>
</div>

{/block}

<select id="qs-selector" name="qs-selector[]" class="lms-ui-quick-search-selector lms-ui-multiselect-selection-group" multiple>

</select>

<script>
	var qs_data = {
		"qs-properties": {}
	};
	{foreach $qs_properties as $mode => $properties}
	qs_data["qs-properties"]["{$mode}"] = "{implode(',', array_keys($properties))}";
	{/foreach}

    var qs_fields = {};
    {foreach $qs_fields as $field => $dummy}
    qs_fields["{$field}"] = true;
    {/foreach}

    $('#qs-selector').each(function() {
        var selector = $(this);
		var field_count = Object.keys(qs_fields).length;
    	$('.lms-ui-quick-search-field[data-mode]').each(function() {
    		var mode = $(this).attr('data-mode');
    		if (field_count && !qs_fields.hasOwnProperty(mode))
    			$(this).hide();
            selector.append('<option value="' + mode + '"' + (!field_count || qs_fields.hasOwnProperty(mode) ? ' selected' : '') +
                '>' + $(this).attr('data-label') + '</option>');
    	});
    	new multiselect({
            id: $(this).attr('id'),
            defaultValue: null,
            icon: "img/asc_order.gif",
            type: 'tiny'
        });
    	$('#qs-selector').change(function() {
			var qs_fields = [];
            $('#qs-selector-layer input:checked').each(function () {
				qs_fields.push($(this).val());
			});
			$('.lms-ui-quick-search-field').hide();
			$.each(qs_fields, function(index, value) {
				$('.lms-ui-quick-search-field[data-mode="' + value + '"]').show();
			});
            qs_data["qs-fields"] = qs_fields.join(',');
			$.ajax({
				method: "POST",
				url: '?m=persistentsetting',
				data: qs_data
			});
    	});
	});

    $('select.lms-ui-quicksearch-property-selection').each(function(k) {
        var icon = $(this).prev().attr('src');
        var id = $(this).attr('id');
        var mode = $(this).closest('.lms-ui-quick-search-field').attr('data-mode');
        $(this).prev().remove();
		new multiselect({
			id: id,
			defaultValue: null,
			icon: icon,
			type: 'tiny'
		});
		$('#' + id).change(function() {
			var properties = [];
			var id = $(this).attr('id');

			$('#' + id + '-layer input:checked').each(function () {
				properties.push($(this).val());
			});
			qs_data["qs-properties"][mode] = properties.join(',');
            $.ajax({
				method: "POST",
				url: '?m=persistentsetting',
				data: qs_data
			});
		});
	});

    $('.lms-ui-quick-search[data-keyboard-shortcut]').each(function() {
		var input = $(this);
    	Mousetrap.bindGlobal(input.attr('data-keyboard-shortcut'), function (e) {
			e.preventDefault();
            input.click();
		});
	});
</script>
