<!--// $Id$ //-->
<style>

	#qrcode-image {
		margin-top: 0.4em;
	}

</style>
<TABLE class="lmsbox" style="width: 100%;" cellpadding="3">
	<colgroup>
		<col style="width: 1%;">
		<col style="width: 1%;">
		<col style="width: 98%;">
	</colgroup>
	<THEAD>
		<TR>
			<TD class="bold nobr" colspan="3">
				<IMG src="img/pass.gif" alt="">
				{$userinfo.login} ({$userinfo.id|string_format:"%04d"})
			</TD>
		</TR>
	</THEAD>
	<TBODY>
		<TR>
			<TD>
				<IMG src="img/users.gif" alt="">
			</TD>
			<TD class="bold nobr">
				{trans("First name:")}
			</TD>
			<TD class="bold">
				{$userinfo.firstname}
			</TD>
		</TR>
		<TR>
			<TD>
				<IMG src="img/users.gif" alt="">
			</TD>
			<TD class="bold nobr">
				{trans("Last name:")}
			</TD>
			<TD class="bold">
				{$userinfo.lastname}
			</TD>
		</TR>
{if $userinfo.position}
		<TR>
			<TD class="nobr">
				<IMG src="img/info.gif" alt="">
			</TD>
			<TD class="bold">{trans("Position:")}</TD>
			<TD>
				{$userinfo.position}
			</TD>
		</TR>
{/if}
{if $userinfo.email}
		<TR>
			<TD class="nobr">
				<IMG src="img/mail.gif" alt="">
			</TD>
			<TD class="bold">{trans("E-mail:")}</TD>
			<TD>
				<A href="mailto:{$userinfo.email}">{$userinfo.email}</A>
			</TD>
		</TR>
{/if}
{if $userinfo.phone}
		<TR>
			<TD class="nobr">
				<IMG src="img/sms.gif" alt="">
			</TD>
			<TD class="bold">{trans("Phone:")}</TD>
			<TD>
				{$userinfo.phone}
			</TD>
		</TR>
{/if}
		<TR>
			<TD class="nobr">
				<IMG src="img/options.gif" alt="">
			</TD>
			<TD class="bold">{trans("Notification:")}</TD>
			<TD>
				{if !$userinfo.ntype}{trans("none")}{else}{$userinfo.ntype}{/if}
			</TD>
		</TR>
		<tr>
			<td class="nobr">
				<img src="img/{if !$userinfo.access}no{/if}access.gif" alt="">
			</td>
			<td class="bold">{trans("Account active:")}</td>
			<td>
				{if !$userinfo.access}{trans("no")}{else}{trans("yes")}{/if}
			</td>
		</tr>
{if $userinfo.accessfrom || $userinfo.accessto}
		<tr>
			<td class="nobr">
				<img src="img/calendar.gif" alt="">
			</td>
			<td class="bold">{trans("Account active:")}</td>
			<td>
				{if $userinfo.accessfrom}<span class="bold">{trans("from")}:</span> {$userinfo.accessfrom}{/if}
				{if $userinfo.accessto}<span class="bold"> {trans("to")}:</span> {$userinfo.accessto}{/if}
			</td>
		</tr>
{/if}
		<TR>
			<TD class="nobr valign-top">
				<IMG src="img/pass.gif" alt="">
			</TD>
			<TD class="bold nobr valign-top">
				{trans("Two factor authentication:")}
			</TD>
			<TD class="nobr valign-top">
				{if $userinfo.twofactorauth}
					{trans("yes")}
					{if ConfigHelper::checkPrivilege('user_management')}
						&nbsp;&nbsp;
						{button icon="password" id="secretkey-show-button" label="Show secret key"}
						{button icon="password" id="secretkey-hide-button" label="Hide secret key" visible=false}
					{/if}
				{else}
					{trans("no")}
				{/if}
			</TD>
		</TR>
{if ConfigHelper::checkPrivilege('user_management') && $userinfo.twofactorauth}
		<tr id="secretkey" style="display: none;">
			<td colspan="2"></td>
			<td>
				{$userinfo.twofactorauthsecretkey}
				<br>
				<img id="qrcode-image" src="data:image/png;base64, {$qrcode_image}">
			</td>
		</tr>
		<TR>
			<TD class="nobr">
				<IMG src="img/node.gif" alt="">
			</TD>
			<TD class="nobr bold">
				{trans("Trusted devices:")}
			</TD>
			<TD class="nobr">
				{count($userinfo.trusteddevices)}
				{if count($userinfo.trusteddevices) && ConfigHelper::checkPrivilege('user_management')}
					&nbsp;
					{button icon="delete" id="remove-trusted-devices" label="Remove"}
				{/if}
			</TD>
		</TR>
{/if}
		<TR>
			<TD class="nobr">
				<IMG src="img/ip.gif" alt="">
			</TD>
			<TD class="nobr">
				<span class="bold">{trans("Allowed hosts:")}</span>
			</TD>
			<TD class="nobr">
				{if $userinfo.hosts}{$userinfo.hosts}{else}{trans("all")}{/if}
			</TD>
		</TR>
		<TR>
			<TD class="nobr">
				<IMG src="img/passwd.gif" alt="">
			</TD>
			<TD class="bold nobr">
				{trans("Password expiration:")}
			</TD>
			<TD class="nobr">
				{$_PASSWDEXPIRATIONS[$userinfo.passwdexpiration]}
			</TD>
		</TR>
		<TR>
			<TD class="nobr">
				<IMG src="img/passwd.gif" alt="">
			</TD>
			<TD class="bold nobr">
				{trans("Last password change:")}
			</TD>
			<TD class="nobr">
				{$userinfo.passwdlastchange}
			</TD>
		</TR>
		<TR>
			<TD>
				<IMG src="img/pass.gif" alt="">
			</TD>
			<TD class="bold nobr">{trans("Access rights:")}</TD>
			<TD>
				<ul>
				{foreach $accesslist as $access}
				{if $access.enabled}
				<li class="acl">{$access.name}</li>
				{/if}
				{/foreach}
				</ul>
			</TD>
		</TR>
		<TR>
			<TD>
				<IMG src="img/group.gif" alt="">
			</TD>
			<TD class="bold nobr">{trans("Excluded groups:")}</TD>
			<TD>
				{foreach from=$excludedgroups item=item}
				{if $item@first}<ul>{/if}
				<li class="acl"><a href="?m=customergroupinfo&id={$item.id}">{$item.name}</a></li>
				{if $item@last}</ul>{/if}
				{foreachelse}
				-
				{/foreach}
			</TD>
		</TR>
		<TR>
			<TD></TD>
			<TD class="bold nobr">{trans("Last login:")}</TD>
			<TD>
				{$userinfo.lastlogin}, {$userinfo.lastloginip} {if $userinfo.lastloginip != $userinfo.lastloginhost}({$userinfo.lastloginhost}){/if}
			</TD>
		</TR>
		<TR>
			<TD></TD>
			<TD class="bold nobr">{trans("Last failed login:")}</TD>
			<TD>
				{$userinfo.faillogin}, {$userinfo.failedloginip} {if $userinfo.failedloginip != $userinfo.failedloginhost}({$userinfo.failedloginhost}){/if}
			</TD>
		</TR>
		{block name="other-information"}
		{/block}
		<TR>
			<TD COLSPAN="3" class="text-right">
				{if $layout.logid ne $userinfo.id}
					{if !$userinfo.access}
					<a href="?m=useraccess&amp;id={$userinfo.id}&amp;access=1">{trans("Connect")} <img src="img/noaccess.gif" alt=""></a>
					{else}
					<a href="?m=useraccess&amp;id={$userinfo.id}&amp;access=0">{trans("Disconnect")} <img src="img/access.gif" alt=""></a>
					{/if}
				{/if}
				<A href="?m=useredit&amp;id={$userinfo.id}" accesskey="E">{trans("Edit")} <IMG src="img/edit.gif" alt=""></A>
				<A id="delete-user" href="?m=userdel&id={$userinfo.id}">{trans("Delete")} <img src="img/delete.gif" alt=""></A>
				<A href="?m=userpasswd&amp;id={$userinfo.id}">{trans("Change password")} <IMG src="img/keys.gif" alt=""> </A>
				<a href="?m=userlist">{trans("User list")} <img src="img/users.gif" alt=""></a>
			</TD>
		</TR>
	</TBODY>
</TABLE>
<script>

	$('#delete-user').click(function() {
		confirmDialog($t("Are you sure, you want to irreversibly delete that user account?"), this).done(function() {
			location.href = $(this).attr('href');
		});
		return false;
	});

	$(function() {
		$('#secretkey-show-button').click(function() {
			$(this).hide();
			$('#secretkey-hide-button').show();
			$('#secretkey').show();
		});

		$('#secretkey-hide-button').click(function() {
			$(this).hide();
			$('#secretkey-show-button').show();
			$('#secretkey').hide();
		});

		$('#remove-trusted-devices').click(function() {
			confirmDialog($t("Are you sure you want to remove all trusted devices?"), this).done(function() {
				location.href = '?m=useredit&id={$userinfo.id}&removetrusteddevices=1';
			});
			return false;
		});
	});

</script>
