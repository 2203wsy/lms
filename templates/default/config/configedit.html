{extends file="layout.html"}
{block name=title}LMS: {$layout.pagetitle|striphtml}{/block}
{block name=module_content}
<!--// $Id$ //-->
<H1>{$layout.pagetitle}</H1>

<style>

	.lmsbox thead td:last-child {
		display: flex;
		justify-content: flex-start;
		align-items: center;
	}

	.lmsbox thead tr:nth-child(n+1) {
		border-top: 0;
	}

	.config-var-suggestion {
		z-index: 9999 !important;
	}

</style>

<FORM method="POST" id="configedit" action="?m=configedit&id={$config.id}" name="config">
<INPUT type="submit" class="hiddenbtn">
<TABLE class="lmsbox">
	<colgroup>
		<col style="width: 1%;">
		<col style="width: 1%;">
		<col style="width: 98%;">
	</colgroup>
    <THEAD>
		<TR>
			<TD>
				<img src="img/settings.gif" alt="">
			</TD>
			<TD class="bold"width="1%">
				{trans("Section:")}
			</TD>
			<td>
				<SELECT size="1" name="config[section]" size="30" {tip class="lms-ui-combobox" text="Select section" trigger="section"}
						{if !in_array($config.section, $sections)} data-value="{$config.section}"{/if}>
					{foreach $sections as $section}
						<OPTION value="{$section}"{if $config.section == $section} selected{/if}>{$section}</OPTION>
					{/foreach}
				</SELECT>
			</td>
		</TR>
		<TR>
			<TD>
				<img src="img/settings.gif" alt="">
			</TD>
			<TD class="bold"width="1%">
				{trans("Name:")}
			</TD>
			<TD>
				<INPUT type="text" name="config[var]" value="{$config.var}"
						{tip class="lms-ui-autogrow" text="Enter option name" trigger="var" bold=1}>
			</TD>
		</TR>
    </THEAD>
    <TBODY>
		<TR>
			<TD>
				<img src="img/producer.gif" alt="">
			</TD>
			<TD class="bold">
				{trans("Value:")}
			</TD>
			<TD>
				<TEXTAREA rows="5" cols="50" name="config[value]" {tip class="lms-ui-wysiwyg-editor" text="Enter option value" trigger="value"} data-wysiwyg="{if $config.type == $smarty.const.CONFIG_TYPE_RICHTEXT || (isset($config.wysiwyg.value) && ConfigHelper::checkValue($config.wywiwyg.value))}true{else}false{/if}">{$config.value}</TEXTAREA>
			</TD>
		</TR>
		<TR>
			<TD>
				<img src="img/info1.gif" alt="">
			</TD>
			<TD class="bold">
				{trans("Comment:")}
			</TD>
			<TD>
				<TEXTAREA rows="5" cols="50" name="config[description]" {tip text="Enter description (optional)" trigger="description"}>{$config.description}</TEXTAREA>
			</TD>
		</TR>
		<TR>
			<TD>
				<img src="img/wait.gif" alt="">
			</TD>
			<TD class="bold">
				{trans("Status:")}
			</TD>
			<TD>
				<INPUT type="checkbox" value="1" id="disabled" name="config[disabled]" {if $config.disabled}CHECKED{/if} {tip text="You can turn it off"}><label for="disabled"> {trans("Off")}</label>
			</TD>
		</TR>
		{if ConfigHelper::checkPrivilege('superuser')}
		<TR>
			<TD>
				<img src="img/desc.gif" alt="">
			</TD>
			<TD class="bold">
				{trans("Type:")}
			</TD>
			<TD>
				<SELECT size="1" name="config[type]" {tip text="Select config type" trigger="type"}>
					{foreach $_CONFIG_TYPES as $key => $type}
						<OPTION value="{$key}"{if $config.type == $key} selected{/if}>{$type}</OPTION>
					{/foreach}
				</SELECT>
			</TD>
		</TR>
		{/if}
		<TR>
			<TD align="right" colspan="3">
				<A href="javascript:document.config.submit();" accesskey="s">{trans("Submit")} <img src="img/save.gif" alt=""></A>
				<A id="delete-config" href="?m=configdel&id={$config.id}&globalconf=1" data-name="{$config.section}.{$config.var}">{trans("Delete")} <img src="img/delete.gif" alt=""></A>
				<A href="?m=configlist">{trans("Cancel")} <img src="img/cancel.gif" alt=""></A>
			</TD>
		</TR>
    </TBODY>
</TABLE>
</FORM>

{include file="config/configusers.html"}

<script>

	$(function() {
		$('form[name="config"] [name="config[var]"]').focus();

		$('[name="config[type]"]').change(function() {
			$('[name="config[value]"]').trigger('lms:visual_editor_change_required', {
				ifShow: $(this).val() == '{$smarty.const.CONFIG_TYPE_RICHTEXT}'
			});
		});

		$('#delete-config').click(function() {
			var name = $(this).attr('data-name');
			confirmDialog($t("Are you sure, you want to delete option '$a' from database?\n\nThis action will remove this option for all users.", name), this).done(function() {
				location.href = $(this).attr('href');
			});
			return false;
		});

		new AutoSuggest({
			form: '#configedit',
			elem: '[name="config[var]"]',
			uri: '?m=quicksearch&ajax=1&mode=config&what=',
			emptyValue: true,
			class: 'config-var-suggestion',
			onSubmit: function (data) {
				$('[name="config[var]"]').val(data.name).trigger('autogrow');
				$('[name="config[section]"]').scombobox('val', data.section);
			},
			onLoad: function() {
				$('[name="config[var]"]:ui-tooltip').tooltip('destroy');
			},
			onAjax: function(uri) {
				return uri + '&section=' + $('[name="config[section]"]').scombobox('val');
			}
		});

	});

</script>
{/block}
