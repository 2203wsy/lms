<DIV ID="pool-edit-dialog" CLASS="lms-ui-dialog" TITLE="{trans("Edit")}">
    <STYLE>
        ol.dialog-box {
            list-style: none;
            padding-left: 0;
        }
        ol.dialog-box li {
            padding-bottom: 5px;
        }
        ol.dialog-box textarea {
            width: 98%;
            resize: vertical;
        }
        ol.dialog-box select {
            padding: 2px;
        }
    </STYLE>

    <FORM ACTION="?m={$layout.module}" METHOD="POST">
    	<INPUT TYPE="hidden" ID="edit-pool-id" NAME="poolid">
    
        <OL CLASS="dialog-box">
            <LI>
                {trans("Name:")}<BR>
                <INPUT TYPE="text" ID="edit-name" NAME="name"  CLASS="text ui-widget-content ui-corner lms-ui-dialog-input">
            </LI>
            <LI>
                {trans("First number:")}<BR>
                <INPUT TYPE="number" ID="edit-poolstart" NAME="poolstart" MAXLENGTH="20" MIN="0" CLASS="text ui-widget-content ui-corner lms-ui-dialog-input">
            </Li>
            <LI>
                {trans("Last number:")}<BR>
                <INPUT TYPE="number" ID="edit-poolend" NAME="poolend" MAXLENGTH="20" MIN="0" CLASS="text ui-widget-content ui-corner lms-ui-dialog-input">
            </LI>
            <LI>
                {trans("Status:")}<BR>
                <SELECT ID="edit-status" NAME="status" CLASS="lms-ui-dialog-input">
                        <OPTION VALUE="0">{trans('active<!voip>')}</OPTION>
                        <OPTION VALUE="1">{trans('inactive')}</OPTION>
                </SELECT>
            </LI>
            <LI>
                {trans("Description:")}<BR>
                <TEXTAREA ID="edit-description" NAME="description" CLASS="text ui-croner lms-ui-dialog-input" ROWS="7" {tip text="Enter notes (optional)"}></TEXTAREA>
            </LI>
        </OL>

        <INPUT TYPE="submit" style="position:absolute; top:-1000px">
    </FORM>
</DIV>

<SCRIPT TYPE="text/javascript">
<!--

var pool_edit_dialog;

$( function() {

    pool_edit_dialog = new LmsUiDialog('pool-edit-dialog');
    pool_edit_dialog.setButtons([
                                    {
                                        text: "{trans("Save")}",
                                        click: function() {
                                            $(this).find("form").submit();
                                        }
                                    },
                                    {
                                        text: "{trans("Cancel")}",
                                        click: function() {
                                            $( this ).dialog( "close" );
                                        }
                                    }
                                ]);

    pool_edit_dialog.handler.find( "form" ).on( "submit", function( event ) {

        $(pool_edit_dialog.handler).find("*")
                                  .removeClass("ui-state-error")
                                  .removeAttr("title");

        $.ajax({
            method: "POST",
            url: "?m=voippoolnumberlist&action=edit",
            data: $(this).serialize(),
            beforeSend: function() {
                pool_edit_dialog.disableButtons();
            }
        })
        .done(function(data) {
            console.log(data);
            
            var response = JSON.parse(data);

            if (response['id'] == undefined) {
                if (response['poolend'] != undefined)
                    $("#poolend").addClass("ui-state-error").prop('title', response['poolend']);

                if (response['poolstart'] != undefined)
                    $("#poolstart").addClass("ui-state-error").prop('title', response['poolstart']);

                if (response['name'] != undefined)
                    $("#name").addClass("ui-state-error").prop('title', response['name']);
            } else {
                var table = $("#poolnumbers").DataTable();
                var size  = $("#poolend").val() - $("#poolstart").val() + 1;
                var appended_class = "";
                var bulb  = '{$bulb_on}';

                if ($("#status").val() == 1) {
                    appended_class = "blend";
                    bulb = '{$bulb_off}';
                }

                table.row.add([$("#name").val(), $("#description").val(), $("#poolstart").val(), $("#poolend").val(), size, 0, size, bulb + ' {$edit_ico} {$delete_ico}'])
                         .draw()
                         .nodes()
                         .to$()
                         .addClass(appended_class)
                         .attr("data-row-id", response['id'])
                         .effect("highlight",{},4000);

                pool_edit_dialog.close();
                pool_edit_dialog.formReset();

                $(pool_edit_dialog.handler).find("*")
                                           .removeClass("ui-state-error")
                                           .removeAttr("title");
            }
            pool_edit_dialog.enableButtons();
        });

        event.preventDefault();
    });
    
    $('body').on("click", ".edit-pool", function() {
    	var row = $(this).closest("tr");
    
        var poolid = $(row).attr("data-pool-id");
    	//console.log( $(row).find("td[data-role=name]").text() );

        $("#edit-pool-id")  .val( poolid );
        $("#edit-name")     .val( $(row).find("td[data-role=name]").text() );
        $("#edit-poolstart").val( $(row).find("td[data-role=pstart]").text() );
        $("#edit-poolend")  .val( $(row).find("td[data-role=pend]").text() );        
        $("#edit-status")   .val( $(row).hasClass("blend") ? 1 : 0 );
     
        pool_edit_dialog.open();
    });
});
//-->
</SCRIPT>
